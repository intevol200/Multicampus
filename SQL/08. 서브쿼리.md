---
__목차__
1. [서브쿼리](#1-서브쿼리)  
  1.1. [단일 행 서브쿼리](#11-단일-행-서브쿼리)  
  1.2. [다중 행 서브쿼리](#12-다중-행-서브쿼리)  
  1.3. [다중 열 서브쿼리](#13-다중-열-서브쿼리) 
  
---

## 1. 서브쿼리
* SQL 명령문 안에 포함된 또다른 SELECT 명령문
* 메인 쿼리보다 먼저 실행
* 서브쿼리는 괄호로 묶어서 표현

```SQL
-- 특정인의 입사일보다 늦게 입사한 사람
SELECT LAST_NAME, HIRE_DATE
FROM EMPLOYEES
WHERE HIRE_DATE > ( SELECT HIRE_DATE
                    FROM EMPLOYEES
                    WHERE UPPER(LAST_NAME) = '&NAME' );

-- 7566 보다 더 많은 급여를 받는 사람
SELECT *
FROM EMP
WHERE SAL > ( SELECT SAL
              FROM EMP
              WHERE EMPNO = 7566 );

-- 2006년에 주문을 하지 않은 고객에 대해 검색하라_
SELECT *
FROM CUSTOMERS C LEFT JOIN ORDERS O
  ON C.CUST_ID = O.CUST_ID AND O.ORDER_DATE BETWEEN TO_DATE('2006/01/01') 
                                                AND TO_DATE('2007/01/01') - 1/86400;

SELECT *
FROM CUSTOMERS C LEFT JOIN
     ( SELECT *
       FROM ORDERS
       WHERE ORDER_DATE BETWEEN TO_DATE('2006/01/01') 
                            AND TO_DATE('2007/01/01') - 1/86400 ) O
ON C.CUST_ID = O.CUST_ID;
```

### 1.1. 단일 행 서브쿼리
* 단일 행 비교연산자
```SQL
SELECT *
FROM EMP
WHERE SAL = ( SELECT MIN(SAL)
              FROM EMP );
              
SELECT *
FROM EMP
WHERE SAL > ( SELECT MIN(AVG(SAL))
              FROM EMP
              GROUP BY DEPTNO );              
```

* HAVING 절의 서브쿼리
```SQL
SELECT DEPARTMENT_ID, MIN(SALARY)
FROM EMPLOYEES
GROUP BY DEPARTMENT_ID
HAVING MIN(SALARY) > ( SELECT MIN(SALARY)
                       FROM EMPLOYEES
                       WHERE DEPARTMENT_ID = 80 );
```

### 1.2. 다중 행 서브쿼리
* 여러 행 비교연산자 (```IN```, ```ANY```, ```ALL```)
* ```NOT IN```을 사용할 때에는 ```null``` 값을 리턴하지 않도록 해야 함  
```null```은 비교가 불가능한 값이기 때문
```SQL
-- IN
SELECT *
FROM EMP
WHERE SAL IN ( SELECT MIN(SAL)
               FROM EMP
               GROUP BY DEPTNO );

-- ANY (= OR)
SELECT *
FROM EMP
WHERE SAL = ANY ( SELECT MIN(SAL)
                  FROM EMP
                  GROUP BY DEPTNO );
                  
-- ALL (= AND)
SELECT *
FROM EMP
WHERE SAL = ALL ( SELECT MIN(SAL)
                  FROM EMP
                  GROUP BY DEPTNO );
```

### 1.3. 다중 열 서브쿼리
* ```IN```만 사용 가능
* 메인쿼리에 서브쿼리와 비교할 컬럼 2개를 순서에 맞게 괄호```( )```로 묶어 두 부분에서 비교가 가능하도록 함
```SQL
SELECT *
FROM EMP
WHERE (DEPTNO, SAL) IN ( SELECT DEPTNO, MIN(SAL)
                         FROM EMP
                         GROUP BY DEPTNO );
```
